
# Secure account management

___
## Фундаментальные концепции

### HTTPS
1. __Authenticity__ - гарантирует подлинность запрашиваемого интернет ресурса
2. __Integrity__ - защищает от изменения переданных и полученных данных (Man In The Middle)
3. __Confidentiality__ - защищает от прослушивания (Eavesdropping)

### Распространенные атаки
1. __Brute force__ - перебор возможных логинов и паролей
2. __Account enumeration attack__ - возможность установить является ли атакуемый пользователем данного сайта путем анализа ответов с сервера.
3. __Cross site request forgery__ - атака при которой пользователь переходит по ссылке, предоставляемой хакером, ведущей на сайт хакера и выполняющей запросы от имени пользователя.

___
## Хранение паролей

1. Хранение хешей паролей. Для того чтобы воостановить из хеша атакующий может использовать заранее сгенеренные данные (радужные таблицы)
2. Использование соли. Соль случайная и для каждого аккаунта хранится в базе вместе с хешем пароля.
3. Использование криптостойких алгоритмов. Правильно использовать __PBKDF2__, __scrypt__, __bcrypt__._

### Криптографическое хеширование.
- __необратимость__
- __коллизии__
    - __1 рода__ - _для конкретно хеша подбор значения с таким же хешем_
    - __2 рода__ - _подбор любой пары значений с одинаковым хешем_

### Плохие практики

Подход          | Проблема
------------    | -------------
Хранение паролей в открытом виде | _Есть потенциальная возможность засветить пароль. Пользователи часто используют одинаковые пароли к разным сайтам. Тогда все аккаунты с одинаковыми паролями могут быть скомпроментированы_
Хранение в зашифрованном виде | _Есть возможность похитить ключ для расширования (особенно если атака изнутри системы). В этом случае становится эквивалентно хранению в открытом виде_
Пересылка долгоживущих паролей по почте | _SMTP небезопасный протокол. Пароли могут быть похищены. Возможность посторонним лицам доступиться к почтовому ящику через социальную инженерию_
Хеширование без соли | _возможность использования готовых радужных таблиц_
Хеширование с одной и той же солью  | _возможность использования радужных таблиц сгенеренных под конкретную базу_
Хеширование не достаточной криптоской хеш функцией  | _Взлом некриптостойких ключей за исчислимое время. Не использовать __MD5__, __SHA_1__._

Гайд от [OWASP](https://cheatsheetseries.owasp.org/cheatsheets/Password_Storage_Cheat_Sheet.html)

___
## Регистрация

### Выбор между использованием почты для логина или отдельного поля
Использование почты          | Отдельное поле для имени пользователя
------------    | -------------
+ проще запомнить | + отображение в интерфейсе не приводит к компроментации почты
+ не нужно дополнительного поля | + возможность отказаться от функциональности смены имени
+ уникально для пользователя |  + возможность заводить несколько аккаутов для одной почты
- иногда может быть не уникально (одна корпоративная почта на несколько пользователей) | - сброс пароля трудно реализуем при использовании разных почтовых ящиков для одного аккаунта
- может изменяться (нужен механизм смены почтового ящика) | - необходимо реализовать механизм восстановления имени

#### email в качестве имени пользователя

1. проверка пароля
    1. ограничение по минимальной длине (сервер и клиент)
    2. требование использовать разнообразные символы (сервер и клиент)
    3. НЕ ограничивать по максимальной длине
    4. НЕ ограничивать по используемым символам
    5. хорошая практика проверка пароля по словарю часто используемых паролей (сервер) 
2. после регистрации
    1. после регистрации нельзя давать полный доступ к функциональности
    1. аккаунт должен быть подтвержден 
    2. возможен вариант с предоставлением частичной функциональности
3. подтверждение
    1. ограниченно время жизни (1 час)
    2. должен чиститься при удачной попытке
    3. должен чиститься если запрашивается повторно
    4. активирует аккаунт через get запрос
4. при попытке зарегистрировать пользователя с той же почтой необходимо
    1. отвечать стандартным ответом (предотвращение account enumeration)
    2. отправлять пользователю письмо что кто-то пытается создать аккаунт с его почтой
5. пресечение попыток автоматизации регистрации
    1. использования Captcha

#### Плохие практики

Подход          | Проблема
------------    | -------------
ограничение на длинну пароля | _безпричинное снижение безопасности системы. Это ограничение призвано ограничить место в б.д. для хранения пароля, но не имеет смысла т.к. при правильном подходе в базе хранится не сам пароль, а хеш ограниченной длинны_
ограничение на используемые в пароле символы| _идея что в пароле может быть вредоносный код. Но она безосновательно т.к. сам пароль нигде не выводится и не исполняется_
запрет на вставку из клипборда в поле пароля | _затрудняет использования менеджера паролей_
сообщение о том что пользователь с указанными именим уже зарегистрирован | расскрытие информации о зарегистрированных пользователях.
нет ограничений на частоту запросов регистрации | возможность account enumeration. Нагрузка на систему рассылку почты что может привести к добавлению почты в спам

___
## Вход
___
## Запомни меня
___
## Изменение деталей аккаута
___
## Сброс пароля
___
## Выход



по курсу Pluralsight [secure-account-management-fundamentals](https://app.pluralsight.com/library/courses/secure-account-management-fundamentals/table-of-contents)
